{% extends 'base.html' %}
{% load static %}
{% block meta %}
<title>Login - Ao Eleven</title>
{% endblock meta %}

{% block body_style %}style="position: relative; min-height: 100vh;"{% endblock body_style %}

{% block content %}
<!-- Video Background -->
<video autoplay muted loop class="absolute inset-0 w-full h-full object-cover z-0 brightness-75">
    <source src="{% static 'video/menkrep.mp4' %}" type="video/mp4">
    Your browser does not support the video tag.
</video>

<div class="relative z-10 max-w-md w-full mx-auto flex items-center justify-center min-h-screen">
  <div class="bg-white rounded-lg border border-gray-200 p-6 sm:p-8 shadow-md relative w-full">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden absolute inset-0 z-50 bg-white bg-opacity-70 flex flex-col items-center justify-center rounded-lg backdrop-blur-sm">
      <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-600 mb-2"></div>
      <p class="text-gray-700 font-medium">Logging in...</p>
    </div>

    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-2xl font-bold text-gray-900 mb-2">Sign In</h1>
      <p class="text-gray-600">Welcome back to Ao Eleven!</p>
    </div>

    <!-- Login Form -->
    <form id="login-form" class="space-y-6">
      {% csrf_token %}
      <div>
        <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
        <input id="username" name="username" type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 transition-colors" placeholder="Enter your username">
      </div>

      <div>
        <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
        <input id="password" name="password" type="password" required class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 transition-colors" placeholder="Enter your password">
      </div>

      <button id="login-btn" type="submit" class="w-full bg-blue-600 text-white font-medium py-3 px-4 rounded-md hover:bg-blue-700 transition-colors flex justify-center items-center">
        <span id="btn-text">Sign In</span>
        <svg id="btn-spinner" class="hidden ml-2 w-5 h-5 animate-spin text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 00-8 8h4z"></path>
        </svg>
      </button>
    </form>

    <!-- Register Link -->
    <div class="mt-6 text-center pt-6 border-t border-gray-200">
      <p class="text-gray-500 text-sm">
        Don't have an account yet? 
        <a href="{% url 'main:register' %}" class="text-blue-600 hover:text-blue-700 font-medium">Register Now</a>
      </p>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("login-form");
  const btn = document.getElementById("login-btn");
  const btnText = document.getElementById("btn-text");
  const btnSpinner = document.getElementById("btn-spinner");
  const overlay = document.getElementById("loading-overlay");

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    if (!username || !password) {
      showToast("Login Gagal", "Semua field wajib diisi.", "error");
      return;
    }
    const csrfToken = document.querySelector("[name=csrfmiddlewaretoken]").value;
    const formData = new FormData(form);

    btn.disabled = true;
    btnText.textContent = "Processing...";
    btnSpinner.classList.remove("hidden");
    overlay.classList.remove("hidden");

    fetch("{% url 'main:login' %}", {
      method: "POST",
      headers: { "X-CSRFToken": csrfToken },
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        showToast("Login Berhasil ðŸŽ‰", "Selamat datang kembali!", "success");
        setTimeout(() => window.location.href = "{% url 'main:home' %}", 1000);
      } else {
        showToast("Login Gagal ðŸ˜“", data.error || "Username atau password salah.", "error");
      }
    })
    .catch(() => showToast("Terjadi Kesalahan", "Server tidak merespons.", "error"))
    .finally(() => {
      btn.disabled = false;
      btnText.textContent = "Sign In";
      btnSpinner.classList.add("hidden");
      overlay.classList.add("hidden");
    });
  });
});
</script>
{% endblock content %}
